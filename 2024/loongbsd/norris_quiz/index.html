<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.139.3">
    <meta name="description" content="">


    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>quiz: tiny VMs for kernel development :: LoongBSD Group Messages</title>

    
    <link href="/css/nucleus.css?1733575624" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1733575624" rel="stylesheet">
    <link href="/css/hybrid.css?1733575624" rel="stylesheet">
    <link href="/css/featherlight.min.css?1733575624" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1733575624" rel="stylesheet">
    <link href="/css/auto-complete.css?1733575624" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1733575624" rel="stylesheet">
    <link href="/css/theme.css?1733575624" rel="stylesheet">
    <link href="/css/hugo-theme.css?1733575624" rel="stylesheet">
    
      <link href="/css/theme-red.css?1733575624" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js?1733575624"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
<link href="/css/papers-custom.css?1733575624" rel="stylesheet">

  </head>
  <body class="" data-url="/2024/loongbsd/norris_quiz/">
    <nav id="sidebar" class=""><div id="header-wrapper">
		<div id="header"><a id="logo" href="https://loongbsd.bitmoe.org/">
  <img src="https://www.freebsd.org/logo/logo-full.png">
</a>
</div><div class="searchbox">
    <form method="get" action="https://duckduckgo.com/" onsubmit="document.getElementById('search-by').value+=' site: papers.FreeBSD.org'">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input id="search-by" type="search" name="q" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
    </form>
</div>
</div>

	<div class="highlightable">
		<ul class="topics">
			
			<li data-uniqueid="1be2bef3997a335bb1ec1978748c9d9f" data-nav-id="/2024/" title="2024" class="dd-item parent ">
				<a href="/2024/">
					<i class="fa fa-angle-double-down"></i>
					2024
				</a>
					<ul class="range-sections">
						<li data-uniqueid="88f7d7a4d7ea697d76d3fbf8208b0132" data-nav-id="/2024/loongbsd/" title="LoongBSD Group | *BSD 家族软件的 LoongArch 支持项目。" class="dd-item parent ">
							<a href="/2024/loongbsd/">
								<i class="fa fa-angle-double-down"></i>
								LoongBSD Group | *BSD 家族软件的 LoongArch 支持项目。
							</a><ul class="ancestor-range-pages">
										
			
				<li data-uniqueid="02d62e6716446d6f2e65da2264e32e23" data-nav-id="/2024/loongbsd/norris_quiz/" title="quiz: tiny VMs for kernel development" class="dd-itemactive">
					<a href="/2024/loongbsd/norris_quiz/">
						<i class="fa fa-angle-right papers-menu-item"></i>
						 quiz: tiny VMs for kernel development
					</a>
				</li>
			
			
				<li data-uniqueid="200cad9ffe5233f325e67e0a142426e2" data-nav-id="/2024/loongbsd/norris_openzfs-fsync-zil/" title="Why fsync() on OpenZFS can’t fail, and what happens when it does" class="dd-item">
					<a href="/2024/loongbsd/norris_openzfs-fsync-zil/">
						<i class="fa fa-angle-right papers-menu-item"></i>
						 Why fsync() on OpenZFS can’t fail, and what happens when it does
					</a>
				</li>
			
										</ul>
						</li>
						<li data-uniqueid="d65b535bbe37d1e58f90832345a51937" data-nav-id="/2024/eurobsdcon/" title="EuroBSDCon" class="dd-item">
							<a href="/2024/eurobsdcon/">
								<i class="fa fa-angle-double-right"></i>
								EuroBSDCon
							</a>
						</li>
						<li data-uniqueid="bc7f95e704d6945d5a52d0abc0e57fa6" data-nav-id="/2024/asiabsdcon/" title="AsiaBSDCon" class="dd-item">
							<a href="/2024/asiabsdcon/">
								<i class="fa fa-angle-double-right"></i>
								AsiaBSDCon
							</a>
						</li>
					</ul>
			</li>
		
			
			<li data-uniqueid="acf80c6dd5a7517f577fe76dc4a43999" data-nav-id="/1995/" title="1995" class="dd-item">
				<a href="/1995/">
					<i class="fa fa-angle-double-right"></i>
					1995
				</a>
					<ul class="range-sections">
			
				<li data-uniqueid="0e5e82c6db132d29f99b75c3b3e981e4" data-nav-id="/1995/mckusick-union_mounts/" title="Union mounts in 4.4BSD-Lite" class="dd-item">
					<a href="/1995/mckusick-union_mounts/">
						<i class="fa fa-angle-right papers-menu-item"></i>
						 Union mounts in 4.4BSD-Lite
					</a>
				</li>
			
					</ul>
			</li>
		
			
		</ul>
		
<ul class="topics">
	<li class="dd-item">
		<a href="/author">
			<i class="fa fa-angle-double-right"></i>
			Author Index
		</a>
	</li>
</ul>


		<section id="footer">
		</section>
	</div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'>LoongBSD Group Messages</a> > <a href='/2024/'>2024</a> > <a href='/2024/loongbsd/'>LoongBSD Group | *BSD 家族软件的 LoongArch 支持项目。</a> > quiz: tiny VMs for kernel development
          
         
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents"></nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              quiz: tiny VMs for kernel development
            </h1>
          

        


  
    <span class="author">
    
  
    <a href="/author/rob-norris/">Rob Norris</a>

    
      &lt;<span class="author-email">robn@despairlabs.com</span>&gt;
    
    </span>
  

<p>At the start of 2023 I traded my 20-year career as a Linux sysadmin for a new
life as a full time OpenZFS developer. Going great, thanks for asking!</p>
<p>Because fast iterative development sucks when you need to wait for a reboot
after every kernel panic, I wrote quiz, a tool to make fast edit-compile-test
cycles on kernel code possible. Under the hood it uses QEMU’s “microvm” profile
and a custom kernel config to boot from cold into the OpenZFS test suite in a
couple of seconds. Its great, and I use it hundreds of times a day.</p>
<p>My FreeBSD-using colleagues naturally said “cool, but what about us?!” so I
started looking at what it would take bring quiz to FreeBSD. The answer to that
is “its complicated”, and involves either adding bhyve to QEMU as a hardware
virtualisation backend, or adding support for direct kernel loading support to
/usr/sbin/bhyve. “Why not both?” I said, before promptly shriveling into a corn
cob.</p>
<p>This talk will show you quiz in action, present the Linux direct boot sequence
and show how I taught bhyve about it, also show how QEMU would like to work and
why it doesn’t quite line up with bhyve’s view of the world, and hopefully show
you how low-level kernel hacking for any OS can be made as simple as hacking on
any other program.</p>



	


<section class="attachments blue">
	<label>
		<i class="fa fa-paperclip" aria-hidden="true"></i>
		Attachments
	</label>
	<div class="attachments-files">
	
		
		<li>
			<a href="/2024/LoongBSD/norris_quiz.files/norris_quiz_bsdcan-2024_slides.pdf" >
				norris_quiz_bsdcan-2024_slides.pdf
			</a>
			(726 kb)
		</li>
	
	</div>
</section>




  <div id="youtubeembed" class="large-video">
    <section class="attachments green">
	<label>
		<i class="fa fa-paperclip" aria-hidden="true"></i>
		Video
	</label>
	<div class="attachments-video">
  	  <div class="video-responsive">
	    <iframe id="widget2" src="https://www.youtube.com/embed/w_tC-D6xWIk?&amp;showinfo=0&amp;modestbranding=1&amp;autohide=1&amp;enablejsapi=1&amp;origin=https:%2F%2Fpapers.freebsd.org" allowfullscreen="" frameborder="0" height="360" width="640"></iframe>
	  </div>
	</div>
    </section>
  </div>





        
        </div> 
        

      </div>

    <div id="navigation">
        
            <a class="nav nav-prev" href="/2024/loongbsd/" title="LoongBSD Group | *BSD 家族软件的 LoongArch 支持项目。"> <i class="fa fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/2024/loongbsd/norris_openzfs-fsync-zil/" title="Why fsync() on OpenZFS can’t fail, and what happens when it does" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1733575624"></script>
    <script src="/js/perfect-scrollbar.min.js?1733575624"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1733575624"></script>
    <script src="/js/jquery.sticky.js?1733575624"></script>
    <script src="/js/featherlight.min.js?1733575624"></script>
    <script src="/js/html5shiv-printshiv.min.js?1733575624"></script>
    <script src="/js/highlight.pack.js?1733575624"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js?1733575624"></script>
    <script src="/js/learn.js?1733575624"></script>
    <script src="/js/hugo-learn.js?1733575624"></script>

    <link href="/mermaid/mermaid.css?1733575624" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1733575624"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

